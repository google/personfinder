{% comment %}
Copyright 2010 Google Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
{% endcomment %}

{% load i18n %}
{% extends "base.html" %}
{% block content %}
<div class="embed">
<h2>{% trans "Embedding the Application" %}</h2>

<p>{% trans "Copy and paste the following HTML code to put this tool on your site" %}:</p>

<pre dir="ltr">&lt;iframe
  src="http://{{env.netloc}}/?small=yes"
  width=400 height=300 frameborder=0
  style="border: dashed 2px #77c"&gt;&lt;/iframe&gt;
</pre>

<p>{% blocktrans %}This gadget is made available under the {{apache_link}}Apache 2.0 license{{end_link}}.{% endblocktrans %}</p>

{% blocktrans %}Any data you receive by collaborating with Google in connection with the gadget is shared under a {{cc_link}}Creative Commons license{{end_link}}.{% endblocktrans %}

<p>
<h2>{% trans "Feedback and Discussion" %}</h2>
<p>
{% blocktrans %}To provide feedback on the People Finder application or to ask questions of the developers or other users, please join the {{googlegroup_email}} mailing list.{% endblocktrans %}

<p>
<h2>{% trans "Downloading Data" %}</h2>
<p>
{% trans "The Person Finder application stores and exports records using the People Finder Interchange Format (PFIF), which is based on XML." %}
{% trans "Documentation on the format is available here:" %}
<ul>
  <li> <a href="http://zesty.ca/pfif/1.2/">
      {% trans "PFIF 1.2 Specification" %}</a>
  <li> <a href="http://zesty.ca/pfif/1.2/pfif-1.2-example.html">
      {% trans "PFIF 1.2 example document" %}</a>
  <li> <a href="http://zesty.ca/pfif/1.1/">
      {% trans "PFIF 1.1 Specification" %}</a>
  <li> <a href="http://zesty.ca/pfif/1.1/pfif-1.1-example.html">
      {% trans "PFIF 1.1 example document" %}</a>
  <li> <a href="http://zesty.ca/pfif/faq.html">
      {% trans "PFIF FAQ and Implementation Guidelines" %}</a>
  <li> <a href="http://www.w3.org/TR/REC-xml/">
      {% trans "XML Specification" %}</a>
</ul>

<p>
{% trans "Person Finder now supports PFIF 1.2." %}

<p>
{% trans "There are several ways to download records from our database:" %}

<h3>{% trans "Atom Feeds" %}</h3>
<p>
{% trans "PFIF 1.2 person and note feeds are available here:" %}
<pre dir="ltr">http://{{env.netloc}}/feeds/person
http://{{env.netloc}}/feeds/note</pre>

{% trans "By default, these feeds return the most recently added person records or note records in reverse chronological order." %}
{% trans "These query parameters are supported:" %}
<ul>
  <li><code>max_results</code>:
  {% trans "Return up to the specified number of results (maximum 200)." %}
  <li><code>skip</code>:
  {% trans "Skip the specified number of records before returning the next <code>max_results</code> results." %}
  <li><code>min_entry_date</code>:
  {% trans "Return only results with an <code>entry_date</code> greater than or equal to the specified timestamp, which should be in <code>yyyy-mm-ddThh:mm:ssZ</code> format.  If this parameter is specified, results will be returned in forward chronological order." %}
  <li><code>person_record_id</code>:
  {% trans "Return only notes for this person record.  This parameter is only valid for the note feed." %}
</ul>

<p>
{% trans "You can use the <code>person_record_id</code> parameter to subscribe to a feed of notes on a specific person." %}

<p>
{% trans "If you need to keep another database synchronized with the Google Person Finder database, you can use the <code>min_entry_date</code> and <code>skip</code> parameters to produce incremental updates." %}
{% trans "Use the latest <code>entry_date</code> you have previously received from Google Person Finder as the <code>min_entry_date</code> for your first request." %}
{% trans "Then take the latest <code>entry_date</code> in the batch you receive, and use it as the <code>min_entry_date</code> for your next request." %}
{% trans "Use the <code>skip</code> parameter to skip the records you already received that have the same <code>entry_date</code>." %}
{% trans "This algorithm is implemented by the download_feed.py script, which is provided in the open source release of Google Person Finder (see below)." %}

<h3>{% trans "Individual Person Record API" %}</h3>
<p>
{% trans "If you know the PFIF person_record_id of a person, you can fetch the person's PFIF record (with notes) in XML format, at the following URL:" %}<br>
<pre dir="ltr">http://{{env.netloc}}/api/read?id=<span class=var>person_record_id</span></pre>

{% trans "The above URL returns a PFIF 1.2 document.  For PFIF 1.1, use the following URL:" %}
<pre dir="ltr">http://{{env.netloc}}/api/read?version=1.1&amp;id=<span class=var>person_record_id</span></pre>

<p>
<h2>{% trans "Uploading Data" %}</h2>

{% trans "You can also push one or more PFIF records to the Person Finder by posting an XML file to the following URL:" %}
<pre dir="ltr">http://{{env.netloc}}/api/write?key=<span class=var>auth_key</span></pre>

<p>
{% trans "Both PFIF 1.1 and 1.2 are accepted." %}
{% blocktrans %}To obtain an auth_key, please contact {{authkey_email}}.{% endblocktrans %}
{% trans "You will need to tell them which PFIF source domain you will be using the key for, and the key can only be used to upload person records whose person_record_id is prefixed with that domain." %}

<p>
{% trans "Once you have prepared an XML file, the following command-line can be used to upload it:" %}
<pre dir="ltr">curl -X POST -H 'Content-type: application/xml' --data-binary @<span class=var>your_file.xml</span> \
    http://{{env.netloc}}/api/write?key=<span class=var>your_auth_key</span></pre>

<p>
{% trans "The XML document can contain &lt;pfif:person&gt; elements with nested &lt;pfif:note&gt; elements." %}
{% blocktrans %}To understand the proper XML format, see the {{pfif_link}}PFIF example document{{end_link}}{% endblocktrans %}.
{% trans "We recommend that you upload a single record or a small number of records as a test, retrieve the records using the Individual Person Record API (/api/read), and view the records on the site to verify that the results are what you expected." %}
{% trans "Pay careful attention to the handling of accented letters, note text, source URLs, and photo URLs (if you have them)." %}

<p>
{% trans "Due to the size limitation on POST requests, you should split up files into batches of 100 &lt;pfif:person&gt; elements." %}
{% trans "If you encounter an error, or need to correct problems in a previous upload, it is safe to upload the same records again.  Records will replace existing records with the same person_record_id or note_record_id." %}

<p>
{% trans "The response will be an XML document like this:" %}

<pre dir="ltr">
&lt;?xml version="1.0"?>
&lt;status:status>
  &lt;status:write>
    &lt;status:record_type>pfif:person&lt;/status:record_type>
    &lt;status:parsed>1&lt;/status:parsed>
    &lt;status:written>1&lt;/status:written>
    &lt;status:skipped>
    &lt;/status:skipped>
  &lt;/status:write>

  &lt;status:write>
    &lt;status:record_type>pfif:note&lt;/status:record_type>
    &lt;status:parsed>1&lt;/status:parsed>
    &lt;status:written>1&lt;/status:written>
    &lt;status:skipped>
    &lt;/status:skipped>
  &lt;/status:write>
&lt;/status:status>
</pre>

{% trans "Each &lt;status:write> element describes one batch of writes.  &lt;status:record_type> is the type of the batch.  &lt;status:parsed> says how many XML records were successfully parsed.  &lt;status:written> says how many were written to the datastore.  In the above example, 1 person and 1 note were successfully written." %}
<p>
{% trans "When there are problems it will look like this:" %}
<pre dir="ltr">
&lt;?xml version="1.0"?>
&lt;status:status>
  &lt;status:write>
    &lt;status:record_type>pfif:person&lt;/status:record_type>
    &lt;status:parsed>1&lt;/status:parsed>
    &lt;status:written>0&lt;/status:written>
    &lt;status:skipped>
      &lt;pfif:person_record_id>google.com/person.4040&lt;/pfif:person_record_id>
      &lt;status:error>not in authorized domain: u'google.com/person.4040'&lt;/status:error>
    &lt;/status:skipped>
  &lt;/status:write>

  &lt;status:write>
    &lt;status:record_type>pfif:note&lt;/status:record_type>
    &lt;status:parsed>1&lt;/status:parsed>
    &lt;status:written>0&lt;/status:written>
    &lt;status:skipped>
      &lt;pfif:note_record_id>zesty.ca/note.53&lt;/pfif:note_record_id>
      &lt;status:error>ValueError: bad datetime: u'xyz'&lt;/status:error>
    &lt;/status:skipped>
  &lt;/status:write>
&lt;/status:status>
</pre>

{% trans "Each &lt;status:skipped> entry describes the reason why a particular record was skipped, and includes the record ID if one was given." %}
<p>
{% trans "When you upload person or note records, you will be replacing any existing records with the same record ID.  It should be safe to upload the same data multiple times while you fix formatting problems." %}

<p>
<h2>{% trans "Source Code" %}</h2>

<p>{% blocktrans %}Google Person Finder is open source, released under the Apache 2.0 License. You can download the source code on the {{codesite_link}}Google Person Finder project site{{end_link}}.{% endblocktrans %}

<p>&nbsp;<br>

{% if close_button %}
  <a href="JavaScript:window.close()">{% trans "Close window" %}</a>
{% else %}
  <a href="{{env.main_url|escape}}">
    {{env.back_chevron}} {% trans "Back to start" %}
  </a>
{% endif %}
{% endblock %}
{% block footer %}{# Intentionally override #}{% endblock %}
